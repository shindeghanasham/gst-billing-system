<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<div th:replace="fragments/header :: head('All Customers')"></div>
</head>
<body>
	<div th:replace="fragments/navbar :: navbar"></div>

	<div class="container-fluid mt-4 mb-3">
		<div class="row">
			<!-- Sidebar -->
			<div class="col-md-3">
				<div class="card">
					<div class="card-header bg-primary text-white">
						<h5 class="card-title mb-0">Admin Panel</h5>
					</div>
					<div class="list-group list-group-flush">
						<a th:href="@{/admin/dashboard}"
							class="list-group-item list-group-item-action"> <i
							class="fas fa-tachometer-alt me-2"></i>Dashboard
						</a> <a th:href="@{/admin/users}"
							class="list-group-item list-group-item-action"> <i
							class="fas fa-users me-2"></i>User Management
						</a> <a th:href="@{/admin/invoices}"
							class="list-group-item list-group-item-action"> <i
							class="fas fa-file-invoice me-2"></i>All Invoices
						</a> <a th:href="@{/admin/customers}"
							class="list-group-item list-group-item-action active"> <i
							class="fas fa-address-book me-2"></i>All Customers
						</a> <a th:href="@{/admin/products}"
							class="list-group-item list-group-item-action"> <i
							class="fas fa-boxes me-2"></i>All Products
						</a> <a th:href="@{/admin/statistics}"
							class="list-group-item list-group-item-action"> <i
							class="fas fa-chart-bar me-2"></i>System Statistics
						</a>
					</div>
				</div>
			</div>

			<!-- Main Content -->
			<div class="col-md-9">
				<div class="d-flex justify-content-between align-items-center mb-4">
					<h2>All Customers</h2>
					<div class="btn-group">
						<a th:href="@{/admin/dashboard}" class="btn btn-outline-primary">
							<i class="fas fa-arrow-left me-2"></i>Back to Dashboard
						</a>
						<button class="btn btn-outline-success" onclick="window.print()">
							<i class="fas fa-print me-2"></i>Print
						</button>
					</div>
				</div>

				<!-- Statistics -->
				<div class="row mb-4">
					<div class="col-md-3">
						<div class="card text-white bg-info">
							<div class="card-body text-center">
								<h4 th:text="${#lists.size(customers)}" class="card-title">0</h4>
								<p class="card-text mb-0">Total Customers</p>
							</div>
						</div>
					</div>
					<div class="col-md-3">
						<div class="card text-white bg-success">
							<div class="card-body text-center">
								<h4 th:text="${customersWithGstin}" class="card-title">0</h4>
								<p class="card-text mb-0">With GSTIN</p>
							</div>
						</div>
					</div>
					<div class="col-md-3">
						<div class="card text-white bg-warning">
							<div class="card-body text-center">
								<h4 th:text="${customersWithEmail}" class="card-title">0</h4>
								<p class="card-text mb-0">With Email</p>
							</div>
						</div>
					</div>
					<div class="col-md-3">
						<div class="card text-white bg-primary">
							<div class="card-body text-center">
								<h4 th:text="${uniqueUsers}" class="card-title">0</h4>
								<p class="card-text mb-0">Active Users</p>
							</div>
						</div>
					</div>
				</div>

				<!-- Customers Table -->
				<div class="card">
					<div class="card-header">
						<h5 class="card-title mb-0">All System Customers</h5>
					</div>
					<div class="card-body">
						<div th:if="${#lists.isEmpty(customers)}" class="text-center py-4">
							<h5 class="text-muted">No customers found in the system</h5>
							<p class="text-muted">Customers will appear here once users
								start adding them.</p>
						</div>

						<div th:unless="${#lists.isEmpty(customers)}"
							class="table-responsive">
							<table class="table table-striped table-hover">
								<thead class="table-dark">
									<tr>
										<th>Name</th>
										<th>Email</th>
										<th>Phone</th>
										<th>GSTIN</th>
										<th>Created By</th>
										<th>Created Date</th>
										<th>Actions</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="customer : ${customers}">
										<td><strong th:text="${customer.name}"></strong></td>
										<td><span th:if="${customer.email}"
											th:text="${customer.email}"></span> <span
											th:unless="${customer.email}" class="text-muted">Not
												provided</span></td>
										<td><span th:if="${customer.phone}"
											th:text="${customer.phone}"></span> <span
											th:unless="${customer.phone}" class="text-muted">Not
												provided</span></td>
										<td><span th:if="${customer.gstin}" class="badge bg-info"
											th:text="${customer.gstin}"></span> <span
											th:unless="${customer.gstin}" class="text-muted">Not
												provided</span></td>
										<td><span th:text="${customer.createdBy.username}"></span>
											<small th:if="${customer.createdBy.role.name() == 'ADMIN'}"
											class="badge bg-danger ms-1">ADMIN</small></td>
										<td
											th:text="${#temporals.format(customer.createdAt, 'dd/MM/yyyy')}"></td>
										<td>
											<div class="btn-group btn-group-sm">
												<a th:href="@{/customers/edit/{id}(id=${customer.id})}"
													class="btn btn-outline-primary" title="Edit Customer">
													<i class="fas fa-edit"></i>
												</a> <a th:href="@{/admin/invoices}"
													class="btn btn-outline-info" title="View Invoices"> <i
													class="fas fa-file-invoice"></i>
												</a>
											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>

				<!-- Customer Distribution -->
				<div class="card mt-4" th:if="${not #lists.isEmpty(customers)}">
					<div class="card-header">
						<h5 class="card-title mb-0">Customer Distribution by User</h5>
					</div>
					<div class="card-body">
						<div class="table-responsive">
							<table class="table table-sm">
								<thead>
									<tr>
										<th>User</th>
										<th>Role</th>
										<th>Customer Count</th>
										<th>Percentage</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="userStat : ${userDistribution}">
										<td th:text="${userStat.username}"></td>
										<td><span th:if="${userStat.role == 'ADMIN'}"
											class="badge bg-danger">ADMIN</span> <span
											th:if="${userStat.role == 'USER'}" class="badge bg-primary">USER</span>
										</td>
										<td th:text="${userStat.customerCount}"></td>
										<td><span
											th:text="${#numbers.formatDecimal((userStat.customerCount / #lists.size(customers)) * 100, 1, 1)}"></span>%
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div th:replace="admin/fragments/footer :: footer"></div>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</body>
</html>