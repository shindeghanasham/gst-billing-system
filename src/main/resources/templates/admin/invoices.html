<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<div th:replace="fragments/header :: head('All Invoices')"></div>
<style>
.invoice-table th {
	background-color: #f8f9fa;
	font-weight: 600;
}
</style>
</head>
<body>
	<div th:replace="fragments/navbar :: navbar"></div>

	<div class="container-fluid mt-4 mb-3">
		<div class="row">
			<!-- Sidebar -->
			<div class="col-md-3">
				<div class="card">
					<div class="card-header bg-primary text-white">
						<h5 class="card-title mb-0">Admin Panel</h5>
					</div>
					<div class="list-group list-group-flush">
						<a th:href="@{/admin/dashboard}"
							class="list-group-item list-group-item-action"> <i
							class="fas fa-tachometer-alt me-2"></i>Dashboard
						</a> <a th:href="@{/admin/users}"
							class="list-group-item list-group-item-action"> <i
							class="fas fa-users me-2"></i>User Management
						</a> <a th:href="@{/admin/invoices}"
							class="list-group-item list-group-item-action active"> <i
							class="fas fa-file-invoice me-2"></i>All Invoices
						</a> <a th:href="@{/admin/customers}"
							class="list-group-item list-group-item-action"> <i
							class="fas fa-address-book me-2"></i>All Customers
						</a> <a th:href="@{/admin/products}"
							class="list-group-item list-group-item-action"> <i
							class="fas fa-boxes me-2"></i>All Products
						</a> <a th:href="@{/admin/statistics}"
							class="list-group-item list-group-item-action"> <i
							class="fas fa-chart-bar me-2"></i>System Statistics
						</a>
					</div>
				</div>
			</div>

			<!-- Main Content -->
			<div class="col-md-9">
				<div class="d-flex justify-content-between align-items-center mb-4">
					<h2>All Invoices</h2>
					<div class="btn-group">
						<a th:href="@{/admin/dashboard}" class="btn btn-outline-primary">
							<i class="fas fa-arrow-left me-2"></i>Dashboard
						</a> <a th:href="@{/invoices/create}" class="btn btn-primary"> <i
							class="fas fa-plus me-2"></i>Create Invoice
						</a>
					</div>
				</div>

				<!-- Statistics Cards -->
				<div class="row mb-4">
					<div class="col-md-4">
						<div class="card text-white bg-primary">
							<div class="card-body">
								<div class="d-flex justify-content-between">
									<div>
										<h6 class="card-title">Total Invoices</h6>
										<h3 th:text="${invoices.size()}" class="card-text">0</h3>
									</div>
									<div class="align-self-center">
										<i class="fas fa-file-invoice fa-2x"></i>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-4">
						<div class="card text-white bg-success">
							<div class="card-body">
								<div class="d-flex justify-content-between">
									<div>
										<h6 class="card-title">Total Revenue</h6>
										<h3 class="card-text">
											₹<span
												th:text="${#numbers.formatDecimal(totalRevenue, 1, 2)}">0.00</span>
										</h3>
									</div>
									<div class="align-self-center">
										<i class="fas fa-rupee-sign fa-2x"></i>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-4">
						<div class="card text-white bg-info">
							<div class="card-body">
								<div class="d-flex justify-content-between">
									<div>
										<h6 class="card-title">Total GST</h6>
										<h3 class="card-text">
											₹<span th:text="${#numbers.formatDecimal(totalGst, 1, 2)}">0.00</span>
										</h3>
									</div>
									<div class="align-self-center">
										<i class="fas fa-percentage fa-2x"></i>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Invoices Table -->
				<div class="card">
					<div
						class="card-header d-flex justify-content-between align-items-center">
						<h5 class="card-title mb-0">All System Invoices</h5>
						<div class="input-group" style="width: 300px;">
							<input type="text" class="form-control"
								placeholder="Search invoices...">
							<button class="btn btn-outline-secondary" type="button">
								<i class="fas fa-search"></i>
							</button>
						</div>
					</div>
					<div class="card-body">
						<div th:if="${invoices.empty}" class="text-center py-4">
							<h5 class="text-muted">No invoices found in the system</h5>
							<p class="text-muted">Invoices will appear here once users
								start creating them.</p>
							<a th:href="@{/invoices/create}" class="btn btn-primary">Create
								First Invoice</a>
						</div>

						<div th:unless="${invoices.empty}" class="table-responsive">
							<table class="table table-striped table-hover invoice-table">
								<thead class="table-dark">
									<tr>
										<th>Invoice #</th>
										<th>Date</th>
										<th>Customer</th>
										<th>Created By</th>
										<th class="text-end">Items</th>
										<th class="text-end">Total Amount</th>
										<th>Actions</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="invoice : ${invoices}">
										<td><strong th:text="${invoice.invoiceNumber}"></strong>
										</td>
										<td
											th:text="${#temporals.format(invoice.invoiceDate, 'dd/MM/yyyy')}"></td>
										<td>
											<div th:text="${invoice.customer.name}"></div> <small
											class="text-muted" th:if="${invoice.customer.gstin}"
											th:text="${invoice.customer.gstin}"></small>
										</td>
										<td><span th:text="${invoice.user.username}"></span>
											<div
												th:if="${invoice.user.role == T(com.gst.billing.model.Role).ADMIN}"
												class="badge bg-danger badge-sm">ADMIN</div>
											<div
												th:if="${invoice.user.role == T(com.gst.billing.model.Role).USER}"
												class="badge bg-primary badge-sm">USER</div></td>
										<td class="text-end" th:text="${invoice.items.size()}"></td>
										<td class="text-end"><strong class="text-success">₹<span
												th:text="${#numbers.formatDecimal(invoice.totalAmount, 1, 2)}"></span></strong>
										</td>
										<td>
											<div class="btn-group btn-group-sm">
												<a th:href="@{/invoices/view/{id}(id=${invoice.id})}"
													class="btn btn-outline-info" title="View Invoice"> <i
													class="fas fa-eye"></i>
												</a> <a th:href="@{/invoices/download/{id}(id=${invoice.id})}"
													class="btn btn-outline-success" title="Download PDF"> <i
													class="fas fa-download"></i>
												</a>
											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>

				<!-- Export Options -->
				<div class="card mt-4">
					<div class="card-header">
						<h5 class="card-title mb-0">Export Data</h5>
					</div>
					<div class="card-body">
						<div class="btn-group">
							<a th:href="@{/invoices/download/excel}"
								class="btn btn-outline-primary"> <i
								class="fas fa-file-excel me-2"></i>Export to Excel
							</a>
							<button class="btn btn-outline-success">
								<i class="fas fa-file-pdf me-2"></i>Export to PDF
							</button>
							<button class="btn btn-outline-info">
								<i class="fas fa-file-csv me-2"></i>Export to CSV
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div th:replace="admin/fragments/footer :: footer"></div>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</body>
</html>